
# 処方箋スキャン - AIお薬管理アプリ

紙の処方箋をカメラで撮影するだけで、お薬の情報をAIが自動で読み取り、在庫や履歴を簡単に管理できるWebアプリケーションです。

## 概要

このアプリケーションは、GoogleのGemini APIを活用して、処方箋の画像からテキスト情報を高精度に抽出します。ユーザーは撮影した処方箋の内容を確認・修正し、保存するだけで、現在服用中のお薬の在庫（残り日数）や過去の処方履歴を手軽に管理できます。日々の服薬管理の負担を軽減し、よりシンプルで安心な体験を提供することを目的としています。

## ✨ 主な機能

- **処方箋のカメラ撮影**: スマートフォンのカメラを直接起動し、紙の処方箋を撮影してアップロードできます。
- **AI-OCRによる情報抽出**: Gemini API (`gemini-2.5-flash`) が処方箋画像から以下の情報を自動で読み取ります。
  - 処方日
  - 薬剤名
  - 容量 (例: 20mg)
  - 用法 (例: 1日3回毎食後)
  - 処方日数
- **確認・修正画面**: AIの読み取り結果と元の画像を並べて表示。ユーザーは内容を確認し、必要に応じて簡単に手動修正が可能です。
- **お薬の在庫管理**: 保存されたデータに基づき、服用期間内のお薬を「残り日数が少ない順」に一覧表示。在庫が一目でわかります。
- **処方履歴**: 過去に登録したすべての処方箋を時系列（新しい順）で確認できます。
- **レスポンシブデザイン**: PC、タブレット、スマートフォンなど、様々なデバイスの画面サイズに最適化されています。

## 🛠️ 技術スタック

- **フロントエンド**: React, TypeScript, Tailwind CSS
- **AI / OCR**: Google Gemini API (`gemini-2.5-flash`)
- **モジュール管理**: esm.sh (CDN経由でのESMモジュール利用)
- **動作環境**: Webブラウザ

## 🚀 実行方法

このアプリケーションは、ビルドプロセスを必要とせず、Webサーバー上で`index.html`をホストするだけで動作するように設計されています。

1.  **APIキーの設定**: アプリケーションは環境変数 `process.env.API_KEY` からGoogle Gemini APIのキーを読み込みます。アプリケーションをホストする環境で、この環境変数を事前に設定してください。
2.  **ブラウザで開く**: `index.html`ファイルにアクセスすると、アプリケーションが起動します。

---

## 🤖 AIへの初期プロンプト例

以下は、このアプリケーションの土台をAIに生成させるために使用できる初期プロンプトの例です。

---

ReactとTypeScript、Tailwind CSSを使用して、以下の仕様で「紙の処方箋管理アプリ」を作成してください。

**アプリの目的:**
ユーザーが紙の処方箋をカメラで撮影するだけで、薬の情報を簡単にデジタル化し、在庫や履歴を管理できるようにする。

**主要機能:**
1.  **ホーム画面:**
    *   現在服用中の薬（在庫）を「残り日数が少ない順」で一覧表示する。各項目には薬剤名、用法、残り日数を表示。
    *   在庫がない場合はその旨を表示する。
    *   画面右下にフローティングアクションボタンとしてカメラボタンを配置し、タップすると処方箋を撮影できる。

2.  **処方箋の読み取りと修正画面:**
    *   カメラで撮影した処方箋画像をGoogle Gemini API (`gemini-2.5-flash`) に送信し、AI-OCRで以下の情報をJSON形式で抽出する：`処方日` (YYYY-MM-DD), `薬剤名`, `容量`, `用法`, `日数`。薬剤は処方箋に書かれた順番を維持すること。
    *   読み取り中は「AIが処方箋を読み取り中...」といったメッセージを含むモーダルローディング画面を表示する。
    *   読み取り後、左に処方箋画像、右に抽出されたデータが入力されたフォームを表示する「確認・修正画面」に遷移する。
    *   ユーザーはフォームの内容を修正できる。
    *   「保存」ボタンでデータをアプリ内に保存しホーム画面に戻る。「キャンセル」で何もせずホーム画面に戻る。

3.  **履歴画面:**
    *   過去に保存した全ての処方箋を「処方日が新しい順」で一覧表示する。

4.  **共通ヘッダー:**
    *   アプリタイトル「処方箋スキャン」を表示する。
    *   「ホーム」と「履歴」を切り替えるナビゲーションボタンを配置する。

**技術要件:**
*   `index.html` と `index.tsx` を使用したシングルページアプリケーションとして構築する。
*   Reactや`@google/genai`などのライブラリは、`index.html`の`importmap`機能を用いてesm.sh経由で読み込む。
*   Gemini APIのAPIキーは `process.env.API_KEY` から取得することを前提とする。
*   UIはクリーンで直感的なデザインにすること。アイコンを効果的に使用して視認性を高める。
*   状態管理にはReactの `useState` を使用し、コンポーネントは機能ごとに適切に分割する (`HomeScreen.tsx`, `CorrectionScreen.tsx`, `HistoryScreen.tsx`, `services/geminiService.ts`など)。
*   カメラアクセスには `<input type="file" accept="image/*" capture="environment">` を使用する。

実際に使用したプロンプトは以下の通りです。
```紙の処方箋管理アプリ PRD (Product Requirements Document)1. はじめに1.1. アプリの目的本アプリ「紙の処方箋管理アプリ」は、ユーザーが処方箋の情報を簡単にデジタル化し、自身の薬の服用状況や在庫を効率的に管理することを目的とします。手書きや印字された処方箋からの情報読み取りをAIが支援し、煩雑な薬の管理作業を極限までシンプルにすることで、ユーザーの安心と利便性を向上させます。1.2. ビジョン薬の管理における「手間」と「不安」を解消し、誰もが迷いなく、自信を持って薬と向き合える「紙」ベースの管理をデジタルで支援する存在となるアプリを目指します。1.3. ターゲットユーザー定期的に複数の薬を服用している個人高齢の家族や子どもの薬を管理している介護者・保護者薬の管理に手間を感じているすべての人々2. 機能要件 (Functional Requirements)2.1. 処方箋の撮影機能ユーザーはアプリ内からカメラを起動し、紙の処方箋を撮影できる。撮影時には、処方箋全体が収まるようにガイドが表示される。撮影された画像は、OCR（光学文字認識）処理のためにサーバーに送信される。2.2. OCRによる情報読み取り機能撮影された処方箋画像から、AI-OCRを用いて以下の情報を自動で読み取る。薬剤名薬剤容量 (例: 250mg, 60mg)用法 (例: 1日3回 食後, 1日2回 頓服)日数 (例: 7日分, 14日分)処方日 (処方箋発行日)様々な書式の処方箋に対応できるよう、AIを活用した高精度な文字認識を目指す。2.3. 読み取り内容の確認・修正機能OCRで読み取られた情報と、撮影した元の処方箋画像を同一画面に並べて表示する。左側に元の処方箋画像、右側に読み取られた各項目（薬剤名、容量、用法、日数、処方日）の入力フィールドを表示する。ユーザーは各入力フィールドをタップすることで、読み取られた内容を手動で修正できる。ユーザーが入力フィールドをタップすると、元の処方箋画像内の該当箇所が視覚的にハイライトされ、どこを修正すべきか直感的に理解できる。修正完了後、ユーザーは「保存」ボタンをタップして情報を確定し、データベースに保存できる。「キャンセル」ボタンでホーム画面に戻れる。2.4. 薬の在庫管理機能（現在在庫リスト）保存された処方箋データに基づき、現在服用期間内にある（在庫があると思われる）薬の一覧を表示する。「処方日」と「日数」から現在の服用期間を自動計算する。リストは「服用期間が短い順（残り日数が少ない順）」に並び替えられて表示される。各項目には、薬剤名、用法、容量、残り日数を表示する。2.5. 過去の履歴表示機能過去に保存されたすべての処方箋データを一覧で表示する。リストは「新しい日付が一番上」に来るように時系列で並び替えられて表示される。各項目には、処方日、薬剤名、用法、容量を表示する。表示順は処方箋に記載されている順番を忠実に再現する。3.5. 対応環境Webブラウザでの動作を基本とする（Canvas環境での動作を想定）。```